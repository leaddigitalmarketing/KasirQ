<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>Kasir Que</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 min-h-screen">

<!-- Header -->
<header class="bg-blue-600 text-white p-4 text-center text-xl font-bold">Kasir Que</header>

<!-- Navigation -->
<nav class="bg-white shadow flex justify-around py-2 fixed bottom-0 w-full">
  <button onclick="showMenu('stok')" class="font-semibold">Stok</button>
  <button onclick="showMenu('kasir')" class="font-semibold">Kasir</button>
  <button onclick="showMenu('laporan')" class="font-semibold">Laporan</button>
</nav>

<!-- Content -->
<main class="p-4 pb-20">

<!-- Stok Produk -->
<section id="stok" class="">
  <h2 class="text-lg font-bold mb-2">Stok Produk</h2>
  <div class="grid gap-2">
    <input id="stokNama" placeholder="Nama Produk" class="p-2 border rounded">
    <input id="stokSatuan" placeholder="Satuan" class="p-2 border rounded">
    <input id="stokModal" type="number" placeholder="Harga Modal" class="p-2 border rounded">
    <input id="stokEcer" type="number" placeholder="Harga Jual Ecer (<5)" class="p-2 border rounded">
    <input id="stokGrosir" type="number" placeholder="Harga Jual Grosir (>5)" class="p-2 border rounded">
    <button onclick="tambahStok()" class="bg-blue-600 text-white p-2 rounded">Tambah Produk</button>
  </div>
  <div class="mt-4">
    <table class="w-full text-sm">
      <thead class="bg-gray-200">
        <tr>
          <th>Nama</th><th>Satuan</th><th>Modal</th><th>Ecer</th><th>Grosir</th>
        </tr>
      </thead>
      <tbody id="stokList"></tbody>
    </table>
  </div>
</section>

<!-- Kasir (Popup) -->
<div id="kasirPopup" class="fixed inset-0 bg-black bg-opacity-40 hidden flex items-center justify-center">
  <div class="bg-white w-full max-w-md p-4 rounded">
    <h2 class="font-bold text-lg mb-2">Transaksi Kasir</h2>
    <input id="cariProduk" oninput="filterProduk()" placeholder="Cari produk..." class="p-2 border rounded w-full mb-2">

    <select id="produkSelect" class="w-full p-2 border rounded mb-2"></select>
    <input id="jumlahJual" type="number" placeholder="Jumlah" class="p-2 border rounded w-full mb-2">
    <button onclick="tambahItem()" class="bg-green-600 text-white p-2 w-full rounded">Tambah</button>

    <div class="mt-3">
      <table class="w-full text-sm">
        <thead class="bg-gray-200">
          <tr><th>Barang</th><th>Qty</th><th>Harga</th><th>Total</th></tr>
        </thead>
        <tbody id="cartList"></tbody>
      </table>
    </div>

    <div class="mt-4 flex gap-2">
      <button onclick="selesaiTransaksi()" class="bg-blue-600 text-white p-2 w-full rounded">Selesai</button>
      <button onclick="closeKasir()" class="bg-red-600 text-white p-2 w-full rounded">Tutup</button>
    </div>
  </div>
</div>

<!-- Invoice Popup -->
<div id="invoicePopup" class="fixed inset-0 bg-black bg-opacity-40 hidden flex items-center justify-center">
  <div class="bg-white p-4 w-full max-w-md rounded">
    <h2 class="font-bold text-lg text-center">Invoice Kasir Que</h2>
    <div id="invoiceDetail" class="text-sm mt-2"></div>
    <button onclick="closeInvoice()" class="bg-green-600 text-white p-2 w-full rounded mt-2">Tutup</button>
  </div>
</div>

<!-- Laporan -->
<section id="laporan" class="hidden">
  <h2 class="text-lg font-bold mb-2">Laporan Penjualan</h2>
  <select id="filterLaporan" class="p-2 border rounded mb-2 w-full"></select>
  <table class="w-full text-sm">
    <thead class="bg-gray-200">
      <tr><th>Nama</th><th>Terjual</th><th>Modal</th><th>Jual</th><th>Laba</th></tr>
    </thead>
    <tbody id="laporanList"></tbody>
  </table>
</section>

</main>

<script>
let stok = [];
let cart = [];
let laporan = [];

function showMenu(menu) {
  document.getElementById('stok').classList.add('hidden');
  document.getElementById('laporan').classList.add('hidden');

  if(menu === 'kasir'){
    openKasir();
  } else {
    document.getElementById(menu).classList.remove('hidden');
  }
}

function tambahStok() {
  let data = {
    nama: stokNama.value,
    satuan: stokSatuan.value,
    modal: parseInt(stokModal.value),
    ecer: parseInt(stokEcer.value),
    grosir: parseInt(stokGrosir.value)
  };
  stok.push(data);
  renderStok();
  renderProdukSelect();
}

function renderStok() {
  stokList.innerHTML = stok.map(s => `
    <tr><td>${s.nama}</td><td>${s.satuan}</td><td>${s.modal}</td><td>${s.ecer}</td><td>${s.grosir}</td></tr>
  `).join('');
}

function renderProdukSelect() {
  produkSelect.innerHTML = stok.map((s,i)=>`<option value="${i}">${s.nama}</option>`).join('');
}

function openKasir(){
  kasirPopup.classList.remove('hidden');
}

function closeKasir(){
  kasirPopup.classList.add('hidden');
}

function tambahItem(){
  let i = produkSelect.value;
  let qty = parseInt(jumlahJual.value);
  let harga = qty < 5 ? stok[i].ecer : stok[i].grosir;

  let item = {nama:stok[i].nama, qty, harga, total: qty*harga, modal: stok[i].modal};
  cart.push(item);
  renderCart();
}

function renderCart(){
  cartList.innerHTML = cart.map(c=>`
    <tr><td>${c.nama}</td><td>${c.qty}</td><td>${c.harga}</td><td>${c.total}</td></tr>
  `).join('');
}

function selesaiTransaksi(){
  let total = 0;
  let html = ``;
  cart.forEach(c=>{
    total += c.total;
    laporan.push(c);
    html += `<div>${c.nama} - ${c.qty} x ${c.harga} = ${c.total}</div>`;
  });

  html += `<hr class='my-2'><b>Total: ${total}</b>`;
  invoiceDetail.innerHTML = html;
  invoicePopup.classList.remove('hidden');
  cart = [];
  renderCart();
  renderLaporan();
}

function closeInvoice(){
  invoicePopup.classList.add('hidden');
}

function renderLaporan(){
  laporanList.innerHTML = laporan.map(l=>`
    <tr>
      <td>${l.nama}</td>
      <td>${l.qty}</td>
      <td>${l.modal}</td>
      <td>${l.total}</td>
      <td>${l.total - (l.modal*l.qty)}</td>
    </tr>
  `).join('');
}

</script>
</body>
</html>
